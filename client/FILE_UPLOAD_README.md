# Функциональность загрузки файлов в комментариях

## Обзор

Добавлена возможность прикрепления файлов к основным комментариям (не к ответам). Поддерживаются картинки и текстовые файлы TXT размером до 100KB.

## Компоненты

### FileUpload
- **Путь**: `src/components/molecules/file-upload/`
- **Назначение**: Компонент для выбора и загрузки файлов
- **Особенности**:
  - Валидация типов файлов (картинки + TXT)
  - Проверка размера (максимум 100KB)
  - Лимит на количество файлов (по умолчанию 3)
  - Отображение ошибок валидации
  - Возможность удаления файлов

### AttachedFiles
- **Путь**: `src/components/molecules/attached-files/`
- **Назначение**: Отображение прикрепленных файлов в комментариях
- **Особенности**:
  - Предварительный просмотр картинок
  - Чтение текстовых файлов
  - Скачивание файлов
  - Отображение информации о файлах

## Утилиты

### file-utils.ts
- **Путь**: `src/lib/file-utils.ts`
- **Функции**:
  - `convertFileToBase64()` - конвертация файла в base64
  - `prepareFileForUpload()` - подготовка файла для отправки
  - `prepareFilesForUpload()` - подготовка массива файлов
  - `isImageFile()` - проверка типа изображения
  - `isTextFile()` - проверка типа текстового файла
  - `formatFileSize()` - форматирование размера файла

## Хуки

### useFileUpload
- **Путь**: `src/hooks/use-file-upload.ts`
- **Функциональность**:
  - Управление состоянием загруженных файлов
  - Добавление/удаление файлов
  - Подготовка файлов для отправки
  - Обработка ошибок загрузки

## Интеграция

### CommentForm
- Компонент `FileUpload` интегрирован в форму создания комментариев
- Показывается только для основных комментариев (не для ответов)
- Файлы добавляются в `CommentFormData`

### CommentItem
- Компонент `AttachedFiles` отображает прикрепленные файлы
- Файлы показываются только для основных комментариев (level === 0)
- Поддерживается предварительный просмотр и скачивание

## Типы данных

### UploadedFile
```typescript
interface UploadedFile {
  id: string;
  file: File;
  name: string;
  size: number;
  type: string;
}
```

### FileData
```typescript
interface FileData {
  name: string;
  type: string;
  size: number;
  data: string; // base64 строка
}
```

## Ограничения

- **Типы файлов**: только картинки и TXT файлы
- **Размер**: максимум 100KB на файл
- **Количество**: максимум 3 файла на комментарий
- **Уровень**: только для основных комментариев (не для ответов)

## Использование

### В форме комментария
```tsx
<FileUpload
  onFilesChange={handleFilesChange}
  maxFileSize={100 * 1024}
  allowedTypes={['image/*', '.txt']}
  maxFiles={3}
  disabled={isSubmitting}
/>
```

### В отображении комментария
```tsx
<AttachedFiles 
  files={comment.files}
  onDownload={handleFileDownload}
/>
```

## Безопасность

- Валидация типов файлов на клиенте
- Проверка размера файлов
- Конвертация в base64 для безопасной передачи
- Ограничение на количество файлов

## Производительность

- Ленивая загрузка файлов
- Мемоизация компонентов
- Оптимизированная обработка больших файлов
- Кэширование base64 данных
